---
import { icons } from 'lucide-static';
const arrowDownIcon = icons['arrow-down'];
const fileDownIcon = icons['file-down'];
---

<section
  id="hero"
  class="hero-section section-pinned bg-background z-10 flex items-center justify-center"
>
  {/* Decorative Lines */}
  <div
    class="hero-line-1 absolute top-[15vh] left-[7vw] w-[30vw] h-px line-primary origin-left scale-x-0"
  ></div>
  <div
    class="hero-line-2 absolute bottom-[20vh] right-[7vw] w-[25vw] h-px line-secondary origin-left scale-x-0"
  ></div>

  {/* Main Content - Centered */}
  <div class="hero-content relative w-full px-6 md:px-[7vw] flex flex-col items-start md:items-center">
    {/* Headline */}
    <div class="hero-headline mb-6 md:mb-8">
      <h1 class="text-[clamp(48px,15vw,120px)] md:text-[clamp(64px,12vw,140px)] font-bold text-foreground leading-[0.85] tracking-[-0.03em]">
        <span class="word block">WILBERT</span>
        <span class="word block text-lime">CHANDRA</span>
      </h1>
    </div>

    {/* Subheadline */}
    <div class="hero-subhead mb-8 md:mb-10 opacity-0">
      <div class="flex items-center gap-4 mb-4">
        <div class="w-8 md:w-12 h-px line-primary"></div>
        <p class="text-[clamp(12px,3vw,16px)] md:text-[clamp(14px,1.5vw,18px)] text-muted-foreground font-mono uppercase tracking-[0.2em]">
          Data Engineer & AI Engineer
        </p>
        <div class="w-8 md:w-12 h-px line-primary"></div>
      </div>
    </div>

    {/* CTA Row */}
    <div class="hero-cta flex flex-col sm:flex-row items-start sm:items-center gap-4 md:gap-6 opacity-0">
      <a
        href="#projects"
        class="scroll-to-projects group flex items-center gap-3 px-6 py-3 border border-primary text-primary font-mono text-sm uppercase tracking-[0.14em] hover:bg-primary hover:text-background transition-colors touch-manipulation"
      >
        View Projects
        <svg class="w-4 h-4 group-hover:translate-y-1 transition-transform" set:html={arrowDownIcon} />
      </a>
      <a
        href="#"
        class="flex items-center gap-2 text-muted-foreground font-mono text-sm uppercase tracking-[0.14em] hover:text-lime transition-colors touch-manipulation"
      >
        <svg class="w-4 h-4" set:html={fileDownIcon} />
        Download CV
      </a>
    </div>

    {/* Location */}
    <div
      class="hero-location absolute bottom-[-20vh] md:bottom-[-25vh] left-6 md:left-auto opacity-0"
    >
      <p class="font-mono text-xs uppercase tracking-[0.14em] text-muted-foreground">
        Jakarta, Indonesia
      </p>
    </div>
  </div>

  {/* Corner Decorations */}
  <div class="absolute top-8 right-8 w-4 h-4 border-t border-r border-white/20"></div>
  <div class="absolute bottom-8 left-8 w-4 h-4 border-b border-l border-white/20"></div>
</section>

<script>
  import gsap from 'gsap';
  import ScrollTrigger from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  const initHero = () => {
    // Clean up existing ScrollTrigger instances
    ScrollTrigger.getAll().forEach((trigger) => {
      if (trigger.vars.trigger === '.hero-section') {
        trigger.kill();
      }
    });

    const section = document.querySelector('.hero-section') as HTMLElement;
    if (!section) return;

    const line1 = section.querySelector('.hero-line-1');
    const line2 = section.querySelector('.hero-line-2');
    const headline = section.querySelector('.hero-headline');
    const subhead = section.querySelector('.hero-subhead');
    const cta = section.querySelector('.hero-cta');
    const location = section.querySelector('.hero-location');
    const words = headline?.querySelectorAll('.word');

    const mm = gsap.matchMedia();

    mm.add("(prefers-reduced-motion: no-preference)", () => {
      const loadTl = gsap.timeline({ defaults: { ease: 'power3.out' } });

      loadTl.fromTo([line1, line2],
        { scaleX: 0 },
        { scaleX: 1, duration: 0.9, stagger: 0.1, transformOrigin: 'left' },
        0
      );

      if (words) {
        loadTl.fromTo(words,
          { y: 40, opacity: 0 },
          { y: 0, opacity: 1, duration: 0.9, stagger: 0.06 },
          0.2
        );
      }

      loadTl.fromTo(subhead,
        { y: 20, opacity: 0 },
        { y: 0, opacity: 1, duration: 0.7 },
        0.5
      );

      loadTl.fromTo(cta,
        { y: 20, opacity: 0 },
        { y: 0, opacity: 1, duration: 0.7 },
        0.6
      );

      loadTl.fromTo(location,
        { y: 10, opacity: 0 },
        { y: 0, opacity: 1, duration: 0.6 },
        0.7
      );
    });

    mm.add("(prefers-reduced-motion: reduce)", () => {
      gsap.set([line1, line2, subhead, cta, location], { opacity: 1, y: 0, scaleX: 1 });
      if (words) gsap.set(words, { opacity: 1, y: 0 });
    });

    const scrollTl = gsap.timeline({
      scrollTrigger: {
        trigger: section,
        start: 'top top',
        end: '+=100%',
        pin: true,
        scrub: 0.6,
        onLeaveBack: () => {
          gsap.set([line1, line2, subhead, cta, location], {
            opacity: 1, x: 0, y: 0
          });
          if (words) gsap.set(words, { opacity: 1, x: 0, y: 0 });
        }
      }
    });

    scrollTl.fromTo(headline,
      { x: 0, opacity: 1 },
      { x: '-10vw', opacity: 0.25, ease: 'power2.in' },
      0.70
    );

    scrollTl.fromTo(subhead,
      { x: 0, opacity: 1 },
      { x: '-10vw', opacity: 0.25, ease: 'power2.in' },
      0.72
    );

    scrollTl.fromTo(cta,
      { x: 0, opacity: 1 },
      { x: '-10vw', opacity: 0.25, ease: 'power2.in' },
      0.74
    );

    scrollTl.fromTo([line1, line2],
      { opacity: 1 },
      { opacity: 0.2, ease: 'power2.in' },
      0.70
    );

    scrollTl.fromTo(location,
      { opacity: 1 },
      { opacity: 0.2, ease: 'power2.in' },
      0.75
    );

    // Scroll to projects listener
    const scrollBtn = section.querySelector('.scroll-to-projects');
    scrollBtn?.addEventListener('click', (e) => {
      e.preventDefault();
      const target = document.querySelector('#projects');
      if (target) {
        target.scrollIntoView({ behavior: 'smooth' });
      }
    });
  };

  initHero();
  document.addEventListener('astro:after-swap', initHero);
</script>
